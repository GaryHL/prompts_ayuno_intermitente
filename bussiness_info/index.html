<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recetas - Guía de Ayuno</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      /* Custom scrollbar for webkit */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
    </style>
  </head>
  <body
    class="bg-gray-50 text-slate-800 h-screen flex overflow-hidden selection:bg-indigo-100 selection:text-indigo-700"
  >
    <!-- Sidebar -->
    <aside
      class="w-full md:w-1/3 lg:w-80 bg-white border-r border-gray-200 flex flex-col z-10 shadow-xl flex-shrink-0 transition-all duration-300"
    >
      <div class="p-6 border-b border-gray-100 bg-white">
        <h1
          class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600"
        >
          Recetario
        </h1>
        <p class="text-sm text-gray-500 mt-1">Guía de Ayuno Intermitente</p>
      </div>

      <div class="flex-1 overflow-y-auto p-4 space-y-6">
        <!-- Stats/Tags Summary -->
        <div
          id="tag-summary"
          class="bg-slate-50 rounded-xl p-4 border border-slate-100"
        >
          <h2
            class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3 flex items-center gap-2"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"
              ></path>
            </svg>
            Explorador de Tags
          </h2>
          <div id="tag-counts" class="flex flex-wrap gap-2">
            <!-- Tags will be injected here -->
            <div class="animate-pulse h-6 w-12 bg-slate-200 rounded-full"></div>
            <div class="animate-pulse h-6 w-16 bg-slate-200 rounded-full"></div>
            <div class="animate-pulse h-6 w-10 bg-slate-200 rounded-full"></div>
          </div>
        </div>

        <!-- Recipe List -->
        <div id="recipe-list">
          <h2
            class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3 flex items-center gap-2"
          >
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
              ></path>
            </svg>
            Menú
          </h2>
          <ul id="recipes-ul" class="space-y-2">
            <!-- Initial clean loading state -->
            <li class="p-3 bg-slate-50 rounded-lg animate-pulse h-12"></li>
            <li class="p-3 bg-slate-50 rounded-lg animate-pulse h-12"></li>
            <li class="p-3 bg-slate-50 rounded-lg animate-pulse h-12"></li>
          </ul>
        </div>
      </div>
    </aside>

    <!-- Main Content Review -->
    <main
      id="main-content"
      class="flex-1 overflow-y-auto relative scroll-smooth"
    >
      <div
        id="recipe-details"
        class="max-w-4xl mx-auto p-6 md:p-10 lg:p-14 min-h-full"
      >
        <!-- Default Empty State -->
        <div
          class="h-full flex flex-col items-center justify-center text-slate-400 mt-20"
        >
          <div
            class="w-24 h-24 bg-indigo-50 text-indigo-200 rounded-full flex items-center justify-center mb-6"
          >
            <svg
              class="w-12 h-12"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
              ></path>
            </svg>
          </div>
          <h2 class="text-xl font-medium text-slate-600">
            Selecciona una receta
          </h2>
          <p class="text-slate-400">
            Elige un plato del menú para ver los detalles, ingredientes y
            preparación.
          </p>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        fetch('recipes.json')
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`)
            }
            return response.json()
          })
          .then((recipes) => {
            // Simulate a tiny delay for smooth feeling if strictly local, but removed for production feel
            renderTagSummary(recipes)
            renderRecipeList(recipes)
          })
          .catch((error) => {
            console.error('Error al cargar las recetas:', error)
            showErrorState()
          })

        function showErrorState() {
          const details = document.getElementById('recipe-details')
          details.innerHTML = `
             <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative" role="alert">
                <strong class="font-bold">Error!</strong>
                <span class="block sm:inline">No se pudieron cargar las recetas. Por favor verifica que recipes.json exista.</span>
             </div>
           `
        }

        function formatQuantity(quantity) {
          if (quantity === 0.5) return '1/2'
          if (quantity === 0.25) return '1/4'
          if (quantity === 0.75) return '3/4'
          if (quantity === 0.33) return '1/3'
          if (quantity === 1.5) return '1 1/2'
          return quantity
        }

        function renderTagSummary(recipes) {
          // Define all available tags from tags.md
          const allTags = {
            core: ['romper_ayuno', 'plato_fuerte', 'snack', 'ultima_comida'],
            secondary: [
              'bajo_costo',
              'alto_en_proteina',
              'sin_gluten',
              'bajo_en_carbohidratos',
              'keto_amigable',
              'vegano',
              'vegetariano',
              'alto_en_fibra',
              'costo_moderado',
              'menos_de_15_minutos',
              'solo_3_ingredientes',
            ],
          }

          // Initialize all tags with 0 count
          const tagCounts = {}
          allTags.core.forEach((tag) => (tagCounts[tag] = 0))
          allTags.secondary.forEach((tag) => (tagCounts[tag] = 0))

          // Count tags from recipes
          recipes.forEach((recipe) => {
            // Count regular tags
            if (recipe.tags) {
              recipe.tags.forEach((tag) => {
                tagCounts[tag] = (tagCounts[tag] || 0) + 1
              })
            }
            // Count core tags
            if (recipe.core_tags) {
              recipe.core_tags.forEach((tag) => {
                tagCounts[tag] = (tagCounts[tag] || 0) + 1
              })
            }
          })

          const tagCountsDiv = document.getElementById('tag-counts')
          tagCountsDiv.innerHTML = ''

          // Render Core Tags
          const coreTitle = document.createElement('div')
          coreTitle.className = 'text-xs font-bold text-indigo-600 mb-2 mt-1'
          coreTitle.textContent = 'Core Tags'
          tagCountsDiv.appendChild(coreTitle)

          allTags.core.forEach((tag) => {
            const count = tagCounts[tag] || 0
            const span = document.createElement('button')
            span.className =
              count > 0
                ? 'text-xs font-medium px-2.5 py-1 bg-indigo-50 border border-indigo-200 text-indigo-700 rounded-full hover:border-indigo-400 hover:bg-indigo-100 transition-colors shadow-sm'
                : 'text-xs font-medium px-2.5 py-1 bg-slate-50 border border-slate-200 text-slate-400 rounded-full'
            span.textContent = `${tag} (${count})`
            tagCountsDiv.appendChild(span)
          })

          // Render Secondary Tags
          const secondaryTitle = document.createElement('div')
          secondaryTitle.className =
            'text-xs font-bold text-slate-600 mb-2 mt-4'
          secondaryTitle.textContent = 'Secondary Tags'
          tagCountsDiv.appendChild(secondaryTitle)

          allTags.secondary.forEach((tag) => {
            const count = tagCounts[tag] || 0
            const span = document.createElement('button')
            span.className =
              count > 0
                ? 'text-xs font-medium px-2.5 py-1 bg-white border border-slate-200 text-slate-600 rounded-full hover:border-indigo-300 hover:text-indigo-600 transition-colors shadow-sm'
                : 'text-xs font-medium px-2.5 py-1 bg-slate-50 border border-slate-200 text-slate-400 rounded-full'
            span.textContent = `${tag} (${count})`
            tagCountsDiv.appendChild(span)
          })
        }

        function renderRecipeList(recipes) {
          const recipesUl = document.getElementById('recipes-ul')
          recipesUl.innerHTML = ''
          recipes.forEach((recipe) => {
            const li = document.createElement('li')
            li.className =
              'group p-3 rounded-lg cursor-pointer hover:bg-white hover:shadow-md hover:border-indigo-100 border border-transparent transition-all duration-200 flex items-center justify-between'

            // Inner content for list item
            li.innerHTML = `
                <span class="font-medium text-slate-700 group-hover:text-indigo-700 transition-colors">${recipe.title}</span>
                <svg class="w-4 h-4 text-slate-300 group-hover:text-indigo-400 opacity-0 group-hover:opacity-100 transition-all transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            `

            li.addEventListener('click', () => {
              // Remove active class from all
              document.querySelectorAll('#recipes-ul li').forEach((el) => {
                el.classList.remove(
                  'bg-white',
                  'shadow-md',
                  'border-indigo-100',
                  'ring-1',
                  'ring-indigo-100',
                )
                el.querySelector('span').classList.remove('text-indigo-700')
                el.querySelector('svg').classList.remove(
                  'opacity-100',
                  'translate-x-1',
                )
              })

              // Add active state to clicked
              li.classList.add(
                'bg-white',
                'shadow-md',
                'border-indigo-100',
                'ring-1',
                'ring-indigo-100',
              )
              li.querySelector('span').classList.add('text-indigo-700')
              li.querySelector('svg').classList.add(
                'opacity-100',
                'translate-x-1',
              ) // Keep arrow visible

              displayRecipeDetails(recipe)
            })
            recipesUl.appendChild(li)
          })
        }

        function displayRecipeDetails(recipe) {
          const detailsDiv = document.getElementById('recipe-details')

          // Fade out effect (simple implementation)
          detailsDiv.style.opacity = '0'

          setTimeout(() => {
            detailsDiv.innerHTML = `
                <article class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                    ${renderHeader(recipe)}
                    
                    <div class="p-8">
                        <div class="flex flex-wrap gap-2 mb-6">
                            ${recipe.tags
                              .map(
                                (tag) =>
                                  `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-800">${tag}</span>`,
                              )
                              .join('')}
                            ${
                              recipe.core_tags && recipe.core_tags.length
                                ? recipe.core_tags
                                    .map(
                                      (tag) =>
                                        `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 ring-1 ring-indigo-200">${tag}</span>`,
                                    )
                                    .join('')
                                : ''
                            }
                        </div>

                        ${renderMetaGrid(recipe)}

                        ${
                          recipe.expert_comment
                            ? `
                            <div class="mb-8 p-4 bg-amber-50 rounded-lg border border-amber-100 flex gap-3">
                                <svg class="w-6 h-6 text-amber-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <div>
                                    <h3 class="text-sm font-bold text-amber-800 mb-1">Comentario del experto</h3>
                                    <p class="text-sm text-amber-700 italic">"${recipe.expert_comment}"</p>
                                </div>
                            </div>
                        `
                            : ''
                        }

                        <div class="grid md:grid-cols-2 gap-10">
                            <div>
                                <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                                    <span class="w-8 h-8 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                                    </span>
                                    Ingredientes
                                </h3>
                                <ul class="space-y-3">
                                    ${recipe.ingredients
                                      .map(
                                        (ing) => `
                                        <li class="flex items-start p-2 rounded hover:bg-slate-50 transition-colors">
                                            <div class="w-1.5 h-1.5 rounded-full bg-indigo-400 mt-2 mr-3 flex-shrink-0"></div>
                                            <span class="text-slate-700">
                                                <span class="font-semibold text-slate-900">${formatQuantity(
                                                  ing.quantity,
                                                )} ${ing.unit}</span> ${
                                          ing.name
                                        }
                                                ${
                                                  ing.is_optional
                                                    ? '<span class="text-slate-400 text-sm ml-1">(opcional)</span>'
                                                    : ''
                                                }
                                                ${
                                                  ing.category
                                                    ? `<span class="text-xs text-slate-400 border border-slate-200 rounded px-1 ml-1">${ing.category}</span>`
                                                    : ''
                                                }
                                            </span>
                                        </li>
                                    `,
                                      )
                                      .join('')}
                                </ul>
                            </div>

                            <div>
                                <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                                     <span class="w-8 h-8 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 014-0h2"></path></svg>
                                    </span>
                                    Instrucciones
                                </h3>
                                <div class="space-y-6">
                                    ${recipe.instructions
                                      .map(
                                        (step, index) => `
                                        <div class="flex gap-4 group">
                                            <div class="flex-shrink-0 w-8 h-8 rounded-full bg-slate-100 text-slate-500 font-bold flex items-center justify-center group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                                                ${index + 1}
                                            </div>
                                            <p class="text-slate-700 leading-relaxed pt-1">${step}</p>
                                        </div>
                                    `,
                                      )
                                      .join('')}
                                </div>
                            </div>
                        </div>

                        ${renderNutrition(recipe)}
                    </div>
                </article>
              `

            // Fade in
            detailsDiv.style.opacity = '1'
            detailsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' })
          }, 150)
        }

        function renderHeader(recipe) {
          const image = recipe.image_url
            ? `<div class="w-full h-64 md:h-80 relative overflow-hidden bg-slate-100">
                     <img src="${recipe.image_url}" alt="${recipe.title}" class="w-full h-full object-cover" onerror="this.parentElement.innerHTML='<div class=\\'h-full bg-gradient-to-r from-indigo-500 to-purple-500 flex items-center justify-center text-white\\'>Imagen no disponible</div>'">
                     <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                   </div>`
            : '<div class="h-32 bg-gradient-to-r from-indigo-500 to-purple-500"></div>'

          return `
                <div class="relative group">
                    ${image}
                    <div class="absolute bottom-0 left-0 p-8 text-white">
                        ${
                          recipe.is_premium
                            ? '<span class="bg-amber-400 text-amber-900 text-xs font-bold px-2 py-1 rounded uppercase tracking-wide mb-2 inline-block shadow-lg">Premium</span>'
                            : ''
                        }
                        <h2 class="text-3xl md:text-4xl font-bold text-white shadow-sm leading-tight">${
                          recipe.title
                        }</h2>
                        <p class="text-indigo-100 mt-2 text-lg max-w-2xl text-shadow">${
                          recipe.description
                        }</p>
                    </div>
                </div>
            `
        }

        function renderMetaGrid(recipe) {
          const summary = recipe.nutritional_summary || {
            calories: 0,
            protein_g: 0,
            fat_g: 0,
            carbs_g: 0,
          }
          return `
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="p-4 rounded-xl bg-slate-50 border border-slate-100 flex flex-col items-center justify-center text-center">
                        <span class="text-slate-400 text-xs uppercase tracking-wider font-semibold mb-1">Tiempo</span>
                        <span class="text-lg font-bold text-indigo-900 flex items-center gap-1">
                            <svg class="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            ${recipe.preparation_time_mins} min
                        </span>
                    </div>
                    <div class="p-4 rounded-xl bg-slate-50 border border-slate-100 flex flex-col items-center justify-center text-center">
                        <span class="text-slate-400 text-xs uppercase tracking-wider font-semibold mb-1">Porciones</span>
                        <span class="text-lg font-bold text-indigo-900 flex items-center gap-1">
                            <svg class="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                            ${recipe.servings}
                        </span>
                    </div>
                     <div class="p-4 rounded-xl bg-slate-50 border border-slate-100 flex flex-col items-center justify-center text-center">
                        <span class="text-slate-400 text-xs uppercase tracking-wider font-semibold mb-1">Calorías</span>
                        <span class="text-lg font-bold text-slate-700">${summary.calories}</span>
                    </div>
                     <div class="p-4 rounded-xl bg-slate-50 border border-slate-100 flex flex-col items-center justify-center text-center">
                        <span class="text-slate-400 text-xs uppercase tracking-wider font-semibold mb-1">Proteína</span>
                        <span class="text-lg font-bold text-slate-700">${summary.protein_g}g</span>
                    </div>
                </div>
            `
        }

        function renderNutrition(recipe) {
          const summary = recipe.nutritional_summary || {
            calories: 0,
            protein_g: 0,
            fat_g: 0,
            carbs_g: 0,
          }
          return `
                <div class="mt-10 border-t border-slate-100 pt-8">
                     <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">Información Nutricional (por porción)</h3>
                     <div class="grid grid-cols-3 gap-6">
                        <div>
                             <div class="text-xs text-slate-500 mb-1">Carbohidratos</div>
                             <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
                                <div class="h-full bg-blue-400" style="width: ${Math.min(
                                  summary.carbs_g * 2,
                                  100,
                                )}%"></div>
                             </div>
                             <div class="mt-1 text-sm font-medium text-slate-700">${
                               summary.carbs_g
                             }g</div>
                        </div>
                        <div>
                             <div class="text-xs text-slate-500 mb-1">Grasas</div>
                             <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
                                <div class="h-full bg-yellow-400" style="width: ${Math.min(
                                  summary.fat_g * 2,
                                  100,
                                )}%"></div>
                             </div>
                             <div class="mt-1 text-sm font-medium text-slate-700">${
                               summary.fat_g
                             }g</div>
                        </div>
                        <div>
                             <div class="text-xs text-slate-500 mb-1">Proteínas</div>
                             <div class="h-2 bg-slate-100 rounded-full overflow-hidden">
                                <div class="h-full bg-red-400" style="width: ${Math.min(
                                  summary.protein_g * 2,
                                  100,
                                )}%"></div>
                             </div>
                             <div class="mt-1 text-sm font-medium text-slate-700">${
                               summary.protein_g
                             }g</div>
                        </div>
                     </div>
                </div>
            `
        }
      })
    </script>
  </body>
</html>
